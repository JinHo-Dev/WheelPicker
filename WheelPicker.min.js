class WheelPicker{drawAll(){for(let t=0;t<this.lists.length;t++)this.draw(t)}draw(t){let i=this.boundaries[t],e=this.boundaries[t+1],s=Math.round(i*this.dpi),h=Math.round(e*this.dpi);this.plane.clearRect(s,0,h-s,this.HEIGHT),this.write(t),this.roll(t)}write(t){let i=this.dpi,e=this.lists[t].length,s=32*e,h=this.papyrusDOM[t],l=this.scrollTop[t];if(1==this.infinites[t]){(l+=96)<0?l=l%s+s:l>0&&(l%=s),l-=96;for(let n=1;l+32+32*(n-1)*e<0;n++)h.height<=32*i+1&&1==n?this.plane.drawImage(h,0,0,h.width,h.height,this.boundaries[t]*i,(-l-64)*i,h.width,32*i):this.plane.drawImage(h,0,h.height*n+(l+32)*i,h.width,(-l-32)*i,this.boundaries[t]*i,0,h.width,(-l-32)*i);for(let r=1;32*(r-1)*e-l-128<32;r++)this.plane.drawImage(h,0,0,h.width,-r*h.height+(l+192)*i,this.boundaries[t]*i,r*h.height-(l+32)*i,h.width,-r*h.height+(l+192)*i)}let a=(l+32)*i;a<0?this.plane.drawImage(h,0,0,h.width,this.HEIGHT,this.boundaries[t]*i,-a,h.width,this.HEIGHT):this.plane.drawImage(h,0,a,h.width,this.HEIGHT,this.boundaries[t]*i,0,h.width,this.HEIGHT)}roll(t){let i=this.boundaries[t],e=this.boundaries[t+1],s=Math.round(i*this.dpi),h=Math.round(e*this.dpi);this.linen.clearRect(s,0,h-s,this.HEIGHT),this.circular.clearRect(s,0,h-s,this.HEIGHT);let l=Array(this.HEIGHT);for(let n=0;n<this.HEIGHT;n++){let r=this.fn[n],a=Math.round(this.HEIGHT/2+(.2*r+.8)*(n-this.HEIGHT/2));if(1==l[a])continue;if(a<96*this.dpi&&a>64*this.dpi)continue;l[a]=1;let o=Math.round(this.WIDTH/2+(.05*r+.95)*(s-this.WIDTH/2)),d=Math.round(this.WIDTH/2+(.05*r+.95)*(h-this.WIDTH/2)),c=.4*r;this.linen.globalAlpha=c,this.linen.drawImage(this.planeDOM,s,n,h-s,1,o,a,d-o,1)}this.linen.globalAlpha=1,this.linen.drawImage(this.planeDOM,s,64*this.dpi,h-s,32*this.dpi,s,64*this.dpi,h-s,32*this.dpi),this.background.split(",")[0].split("(")[1]>140?this.linen.fillStyle="rgba(0,0,10,0.3)":this.linen.fillStyle="rgba(255,255,255,0.3)",this.linen.fillRect(s,Math.round(64*this.dpi),h-s,1),this.linen.fillRect(s,Math.round(96*this.dpi-1),h-s,1),this.circular.drawImage(this.linenDOM,s,0,h-s,this.HEIGHT,s,0,h-s,this.HEIGHT)}constructor(t){this.parent=t,this.timeNpos=[[0,0],[0,0]];let i=t.getElementsByTagName("select");this.selectDOMs=i,this.lists=Array(i.length),this.interv=Array(i.length),this.lastTime=Array(i.length),this.accel=333,this.selecteds=Array(i.length),this.infinites=Array(i.length);for(let e=0;e<i.length;e++){i[e].addEventListener("change",function(t){let i=t.target.closest("div").WheelPicker;i.selecteds[e]=this.selectedIndex,i.scrollTop[e]=32*i.selecteds[e]-96,i.draw(e)});let s=i[e].getElementsByTagName("option");this.lists[e]=Array(s.length);for(let h=0;h<s.length;h++)this.lists[e][h]=s[h].innerText;i[e].style.display="none"}this.dpi=window.devicePixelRatio,this.scrollTop=Array(this.lists.length),this.width=t.offsetWidth,this.height=160,this.WIDTH=Math.round(this.width*this.dpi),this.HEIGHT=Math.round(this.height*this.dpi),this.fn=Array(this.HEIGHT);for(var l=0;l<this.HEIGHT;l++)this.fn[l]=Math.sin(Math.PI/2*l/this.dpi/80);this.planeDOM=document.createElement("canvas"),this.plane=this.planeDOM.getContext("2d",{willReadFrequently:!1,antialias:!1}),this.planeDOM.width=this.WIDTH,this.planeDOM.height=this.HEIGHT,this.planeDOM.style.imageRendering="pixelated",this.linenDOM=document.createElement("canvas"),this.linen=this.linenDOM.getContext("2d",{willReadFrequently:!1,antialias:!1}),this.linenDOM.width=this.WIDTH,this.linenDOM.height=this.HEIGHT,this.linenDOM.style.imageRendering="pixelated",this.circularDOM=document.createElement("canvas"),t.appendChild(this.circularDOM),this.circular=this.circularDOM.getContext("2d",{willReadFrequently:!1,antialias:!1}),this.circularDOM.style.width=this.width+"px",this.circularDOM.width=this.WIDTH,this.circularDOM.style.height=this.height+"px",this.circularDOM.height=this.HEIGHT,this.circularDOM.imageSmoothingEnabled=!1,this.circularDOM.style.imageRendering="pixelated",this.tDOM=document.createElement("div"),this.tDOM.style.position="absolute",this.tDOM.style.width="auto",this.tDOM.style.height="auto",this.tDOM.style.visibility="hidden",this.tDOM.style.whiteSpace="nowrap",this.tDOM.style.fontSize="22px",t.appendChild(this.tDOM),this.boundaries=[0];let n=0;for(let r=0;r<this.lists.length;r++){let a=0;for(let o=0;o<this.lists[r].length;o++)this.tDOM.innerText=this.lists[r][o],a=Math.max(a,this.tDOM.clientWidth);n+=a+32,this.boundaries.push(n)}t.removeChild(this.tDOM),n=(this.width-n)/2;for(let d=0;d<this.boundaries.length;d++)this.boundaries[d]+=n;this.papyrusDOM=Array(this.lists.length),this.papyrus=Array(this.lists.length);for(let c=0;c<this.lists.length;c++)this.papyrusDOM[c]=document.createElement("canvas"),this.papyrus[c]=this.papyrusDOM[c].getContext("2d",{willReadFrequently:!1,antialias:!1}),this.papyrusDOM[c].width=Math.round((this.boundaries[c+1]-this.boundaries[c])*this.dpi),this.papyrusDOM[c].style.imageRendering="pixelated";let p;t.addEventListener("wheel",function(t){t.preventDefault(),t.stopImmediatePropagation();let i=this.getBoundingClientRect();this.WheelPicker.scroll(t.clientX-i.left,t.deltaY/125*32/2),p=clearTimeout(p),p=setTimeout(()=>{for(let t=0;t<this.WheelPicker.scrollTop.length;t++)this.WheelPicker.adj(this.WheelPicker.boundaries[t+1])},400)}),this.isClick=0,t.WheelPicker=this,this.reloadAll()}reloadAll(){this.color=window.getComputedStyle(this.parent).color,this.background=window.getComputedStyle(this.parent).backgroundColor,this.circular.clearRect(Math.round(10*this.dpi),64*this.dpi,Math.round(this.WIDTH-20*this.dpi),1),this.circular.clearRect(Math.round(10*this.dpi),Math.round(96*this.dpi-1),Math.round(this.WIDTH-20*this.dpi),1),this.background.split(",")[0].split("(")[1]>140?this.circular.fillStyle="rgba(0,0,10,0.3)":this.circular.fillStyle="rgba(255,255,255,0.3)",this.circular.fillRect(Math.round(10*this.dpi),64*this.dpi,Math.round(this.WIDTH-20*this.dpi),1),this.circular.fillRect(Math.round(10*this.dpi),Math.round(96*this.dpi-1),Math.round(this.WIDTH-20*this.dpi),1);for(let t=0;t<this.lists.length;t++)this.reload(t)}reload(t){let i=this.parent.getElementsByTagName("select")[t],e=i.getElementsByTagName("option");this.infinites[t]=0,null!=i.getAttribute("infinite")?this.infinites[t]=1:this.infinites[t]=0,this.lists[t]=Array(e.length);for(let s=0;s<e.length;s++)this.lists[t][s]=e[s].innerText;this.selecteds[t]=i.selectedIndex,this.scrollTop[t]=32*this.selecteds[t]-96,this.papyrusDOM[t].height=Math.round(32*this.dpi*this.lists[t].length),this.papyrus[t].font=`${window.getComputedStyle(this.parent).fontWeight} ${Math.round(22*this.dpi)}px ${window.getComputedStyle(this.parent).fontFamily}`,this.papyrus[t].textBaseline="center",this.papyrus[t].fillStyle=this.color,this.papyrus[t].textAlign="center";let h=(this.boundaries[t+1]-this.boundaries[t])/2*this.dpi;for(let l=0;l<this.lists[t].length;l++)this.papyrus[t].fillText(this.lists[t][l],Math.round(h),Math.round((-8+32*l+32)*this.dpi));this.draw(t)}setNth(t){let i=this.boundaries.length-2;for(let e=1;e<this.boundaries.length;e++)if(this.boundaries[e]>=t){i=e-1;break}this.nth=i}scroll(t,i){let e;if(-1==t)e=this.nth;else{e=this.boundaries.length-2;for(let s=1;s<this.boundaries.length;s++)if(this.boundaries[s]>=t){e=s-1;break}}this.scrollTop[e]+=i,this.draw(e)}goto(t,i){let e;if(-1==t)e=this.nth;else{e=this.boundaries.length-2;for(let s=1;s<this.boundaries.length;s++)if(this.boundaries[s]>=t){e=s-1;break}}let h;h=0==this.infinites[e]&&this.selecteds[e]+i<0?-96:0==this.infinites[e]&&this.selecteds[e]+i>=this.lists[e].length?(this.lists[e].length-1)*32-96:(this.selecteds[e]+i)*32-96,h-=this.scrollTop[e];let l=this.scrollTop[e];this.interv[e]=clearInterval(this.interv[e]),this.lastTime[e]=new Date-0,this.interv[e]=setInterval(()=>{let t=(new Date-this.lastTime[e])/1e3;if(t<=0&&(t=.001),t<.1)this.scrollTop[e]=l+h*t*10,this.draw(e);else{this.interv[e]=clearInterval(this.interv[e]);let i=(96+l+h)/32;i=(this.lists[e].length+i%this.lists[e].length)%this.lists[e].length,this.selecteds[e]=i,this.selectDOMs[e].selectedIndex=i;let s=document.createEvent("HTMLEvents");s.initEvent("change",!1,!0),this.selectDOMs[e].dispatchEvent(s),this.scrollTop[e]=32*i-96,this.draw(e)}},1)}stop(t){let i;if(-1==t)i=this.nth;else{i=this.boundaries.length-2;for(let e=1;e<this.boundaries.length;e++)if(this.boundaries[e]>=t){i=e-1;break}}this.interv[i]=clearInterval(this.interv[i])}adj(t){let i;if(-1==t)i=this.nth;else{i=this.boundaries.length-2;for(let e=1;e<this.boundaries.length;e++)if(this.boundaries[e]>=t){i=e-1;break}}let s=this.scrollTop[i],h=(32+s%32)%32;h>=16&&(h-=32),s<=-96&&0==this.infinites[i]&&(h=s+96),s>=32*this.lists[i].length-128&&0==this.infinites[i]&&(h=s-32*this.lists[i].length+128),this.interv[i]=clearInterval(this.interv[i]),this.lastTime[i]=new Date-0,this.interv[i]=setInterval(()=>{let t=(new Date-this.lastTime[i])/1e3;if(t<=0&&(t=.001),t<.1)this.scrollTop[i]=s-h*t*10,this.draw(i);else{this.interv[i]=clearInterval(this.interv[i]);let e=(96+s-h)/32;e=(this.lists[i].length+e%this.lists[i].length)%this.lists[i].length,this.selecteds[i]=e,this.selectDOMs[i].selectedIndex=e;let l=document.createEvent("HTMLEvents");l.initEvent("change",!1,!0),this.selectDOMs[i].dispatchEvent(l),this.scrollTop[i]=32*e-96,this.draw(i)}},1)}initScroll(t,i){let e;if(-1==t)e=this.nth;else{e=this.boundaries.length-2;for(let s=1;s<this.boundaries.length;s++)if(this.boundaries[s]>=t){e=s-1;break}}this.lastTime[e]=new Date-0,this.interv[e]=clearInterval(this.interv[e]),this.interv[e]=setInterval(()=>{let t=(new Date-this.lastTime[e])/1e3;this.lastTime[e]=new Date-0,t<=0&&(t=.001),i>0?(this.scrollTop[e]+=-i*t,this.draw(e),this.scrollTop[e]<-96&&0==this.infinites[e]?i-=this.accel*((-this.scrollTop[e]-96)/2+1)*t:i-=this.accel*t,i<0&&(i=0)):i<0?(this.scrollTop[e]+=-i*t,this.draw(e),this.scrollTop[e]>32*this.lists[e].length-128&&0==this.infinites[e]?i+=this.accel*((this.scrollTop[e]-32*this.lists[e].length+128)/2+1)*t:i+=this.accel*t,i>0&&(i=0)):0==i&&(this.interv[e]=clearInterval(this.interv[e]),this.adj(this.boundaries[e+1]))},1)}pointerStart(t,i){let e=this.parent.getBoundingClientRect();this.setNth(t-e.left),this.timeNpos=[[new Date-0,i],[new Date-0,i]],void 0!=this.interv[this.nth]?this.stop(-1):(this.isClick=1,this.firstX=t,this.firstY=i)}pointerMove(t,i){this.scroll(-1,this.timeNpos[1][1]-i),this.timeNpos[0][1]=this.timeNpos[1][1],this.timeNpos[1][1]=i,this.timeNpos[0][0]=this.timeNpos[1][0],this.timeNpos[1][0]=new Date-0,(this.firstX-t)*(this.firstX-t)+(this.firstY-i)*(this.firstY-i)>20&&(this.isClick=0)}pointerEnd(){if(1==this.isClick){let t=this.parent.getBoundingClientRect();if(0==this.isClick)return;let i=this.firstY-t.top;i<36?this.goto(-1,-2):i<64?this.goto(-1,-1):i>=124?this.goto(-1,2):i>=96&&this.goto(-1,1)}else{let e;220>Math.abs(e=this.timeNpos[0][0]==this.timeNpos[1][0]?0:(this.timeNpos[0][1]-this.timeNpos[1][1])/(this.timeNpos[0][0]-this.timeNpos[1][0])*1e3)?this.adj(-1):this.initScroll(-1,Math.max(Math.min(e,1e3),-1e3))}}}async function WheelPickerStart(){let t=document.querySelectorAll(".WheelPicker");for(let i=0;i<t.length;i++)t[i].innerHTML+="<font style='position:absolute;'>&nbsp;</font>";document.fonts&&await document.fonts.ready;for(let e=0;e<t.length;e++)new WheelPicker(t[e]);let s;window.addEventListener("mousedown",function(t){let i=t.target.closest("div");i&&"WheelPicker"==i.className&&(t.preventDefault(),t.stopImmediatePropagation(),(s=i.WheelPicker).pointerStart(t.clientX,t.clientY))}),window.addEventListener("touchstart",function(t){let i=t.target.closest("div");i&&"WheelPicker"==i.className&&(t.preventDefault(),t.stopImmediatePropagation(),(s=i.WheelPicker).pointerStart(t.touches[0].clientX,t.touches[0].clientY))},{passive:!1}),window.addEventListener("mousemove",function(t){null!=s&&(t.preventDefault(),t.stopImmediatePropagation(),s.pointerMove(t.clientX,t.clientY))}),window.addEventListener("touchmove",function(t){null!=s&&(t.preventDefault(),t.stopImmediatePropagation(),s.pointerMove(t.touches[0].clientX,t.touches[0].clientY))},{passive:!1}),window.addEventListener("mouseup",function(t){null!=s&&(t.preventDefault(),t.stopImmediatePropagation(),s.pointerEnd(),s=null)}),window.addEventListener("touchend",function(t){null!=s&&(t.preventDefault(),t.stopImmediatePropagation(),s.pointerEnd(),s=null)})}window.addEventListener("load",WheelPickerStart,!1);